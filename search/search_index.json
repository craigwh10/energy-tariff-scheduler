{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to Energy Tariff Scheduler","text":"<p>This is designed to help people easily leverage pricing data provided by Energy Suppliers for use cases such as home automation &amp; internet of things.</p> <p>Setting this up yourself can be quite a burden, especially if you need the same functionality across applications, this should allow you to simply install, add actions and start automating!</p>"},{"location":"#do-prices-even-change-that-much","title":"Do prices even change that much?","text":"<p>Yes they do, the energy prices are driven by supply and demand throughout the day, such as when people are awake or asleep, or fluctuations in generation such as it being windy during the day leading to cheaper electricity from renewable sources which are considerably cheaper than fossil fuels.</p> <p>Here's an example of the Octopus Agile tariff for 11 days and the schedules generated for a battery being charged when it's cheap under constant load:</p> <p></p> <p>Source: Linkedin - Craig White</p>"},{"location":"#current-supported-supplier-tariffs","title":"Current supported supplier tariffs","text":"<p>Currently each of these tariffs only support import pricings.</p> <ul> <li>Octopus Agile Tariff</li> <li>Octopus Go (EV Tariff)</li> <li>Intelligent Octopus Go (EV Tariff)</li> </ul>"},{"location":"#prospective-supplier-tariffs","title":"Prospective supplier tariffs","text":"<p>This will ultimately be determined by interest.</p> <ul> <li>Octopus Tracker</li> <li>E.ON Next Flex</li> <li>EDF GoElectric Overnight</li> <li>EDF \"Beat the Peak\"</li> </ul>"},{"location":"#example-usage","title":"Example usage","text":"<p>If you want to be featured on here make a post on Show &amp; Tell and I'll get it listed here :)</p> <ul> <li>battery.craigwh.it: Raspberry Pi4b using smart scheduling to do battery arbitrage to try keep a server online</li> </ul>"},{"location":"#related-links","title":"Related links","text":"<ul> <li>https://github.com/craigwh10/energy-tariff-scheduler</li> <li>https://pypi.org/project/energy-tariff-scheduler/</li> </ul> Next \u2192"},{"location":"common-problems/","title":"Common problems","text":""},{"location":"common-problems/#highly-common-im-not-seeing-any-logs","title":"[Highly common] I'm not seeing any logs","text":"<p>This is likely due to not having configured your logger in your python script, follow the example below:</p> <pre><code>import logging\n\nfrom energy_tariff_scheduler import PricingStrategy, Price, runner\n\nlogging.getLogger(\"energy_tariff_scheduler\").setLevel(logging.INFO)\n</code></pre>"},{"location":"common-problems/#possibly-common-octopus-the-runner-is-using-the-incorrect-product-and-prices","title":"[Possibly common] Octopus: The runner is using the incorrect product and prices","text":"<p>Currently the logic for finding your tariff is it fetches your account details from your provided account number, finds your most recent tariff, gets the tariff code for it and then tries its best to match the closest product code from the current active products provided by Octopus (where they are non-business type and within Octopus brand), here it's assumed that the product code contains as many characters as possible in the tariff code, such as if your tariff code is <code>E-1R-AGILE-FLEX-22-11-25-C</code> if a product doesn't exist for this it may match <code>AGILE-24-10-01</code>.</p> <p>Obviously this isn't foolproof and a big assumption has been made here so expect it to fail, and if it does please raise it on the API issues page and provide relevant logs provided under the <code>DEBUG</code> level, an effort has been made to not log out any sensitive data but please be vigilant not to post any in the case of seeing any.</p>"},{"location":"common-problems/#my-tariff-isnt-supported","title":"My tariff isn't supported","text":"<p>If you hit this problem you should see this error (note the mismatch in the tariff and product that has been found):</p> <pre><code>INFO:root:Latest tariff code: E-1R-VAR-22-11-01-M\nDEBUG:urllib3.connectionpool:https://api.octopus.energy:443 \"GET /v1/products/AGILE-24-10-01/electricity-tariffs/E-1R-VAR-22-11-01-M/standard-unit-rates/?period_from=2025-01-03T00:00:00&amp;period_to=2025-01-03T23:00:00 HTTP/1.1\" 404 58\nThe tariff code you are on isn't supported by this script, please read https://craigwh10.github.io/energy-tariff-scheduler/common-problems/#possibly-common-octopus-the-runner-isnt-finding-my-tariff-or-product\n</code></pre> <p>For the example referenced, the debug level is set as <code>DEBUG</code>.</p>"},{"location":"common-problems/#less-common-the-runner-wont-start-because-of-the-api-not-returning-data","title":"[Less common] The runner wont start because of the API not returning data","text":"<p>This library is build around third party API's, these can fail due to many reasons which are out of this libraries control.</p> <p>I wouldn't reccomend spam retrying the script as this could lead to your IP being blacklisted, the script automatically tries to retry the failed call 3 times (with a 10s delay), it could take upwards of a few days for things to get rectified (as it's people on the other end who need to fix it), so just be patient with it and try every hour or so.</p> <p>Also, when you see this happen be sure to start a discussion on the API issues page to make others aware that this is happening and to help with making the solution more resiliant to these sorts of issues.</p>"},{"location":"installation/","title":"Installation","text":"<p>First check that you have python installed on your machine:</p> <pre><code>python --version\n</code></pre> <p>If you do not then follow this guide or use your preferred manager such as homebrew.</p> <p>Given now you have python installed, use the following command to install the dependency on your machine (or in a virtual environment).</p> <pre><code>pip install energy-tariff-scheduler\n</code></pre>"},{"location":"advanced/custom-prices-to-include/","title":"Custom price_to_include functions","text":"<p>A custom <code>price_to_include</code> function must always return an integer otherwise it will fail, this integer is the number of prices the pricing strategy will act on.</p>"},{"location":"advanced/custom-prices-to-include/#example-octopus-agile","title":"Example (Octopus Agile)","text":"<pre><code># main.py\nfrom energy_tariff_scheduler import runner, Price\n\ndef action_when_cheap(price: Price):\n    print(\"cheap\", price.value)\n\ndef action_when_expensive(price: Price)\n    print(\"expensive\", price.value)\n\ndef prices_to_include(prices: list[Price]):\n    # only get the count where sum cost is no greater than 15p/kWh\n    # e.g if first 4 prices are 3.0 + 5.0 + 3.0 + 4.0 = 15 (it wont include rest)\n\n    total = 0\n    count = 0\n    sorted_prices = sorted(prices, key=lambda obj: min(obj.value, obj.value))\n    for price in sorted_prices:\n        total += price.value\n        count += 1\n        if total &gt;= 15:\n            break \n\n    return count\n\n\nrunner.run_octopus_agile_tariff_schedule(\n    prices_to_include=prices_to_include,\n    action_when_cheap=action_when_cheap,\n    action_when_expensive=action_when_expensive,\n    api_key=\"YOUR-API-KEY\",\n    account_number=\"YOUR-ACCOUNT-NUMBER\"\n)\n</code></pre> <p>In this setup I've created a theoretical scenario where I only want to spend take advantage of 15p/kWh total of prices, and work out from the available prices how many prices that is, which the strategy will then use.</p>"},{"location":"advanced/custom-pricing-strategies/","title":"Custom pricing strategies","text":"<p>By default the scheduler will simply just rank the prices and assign them to the appropriate actions, but you might hit a case where you need something more complex than that, such as if you have a system where constraints are important or if you wanted to introduce another parameter to the scheduling, such as carbon intensity.</p>"},{"location":"advanced/custom-pricing-strategies/#what-are-these","title":"What are these?","text":"<p>Custom pricing strategies are python classes that you define and pass into the method for the appropriate tariff, in these you can write your own functionality that acts on the prices, this is using a Strategy pattern which injects in the config in runtime so that you can use the values you addtionally passed in.</p>"},{"location":"advanced/custom-pricing-strategies/#example-creating-a-custom-pricing-strategy-for-octopus-agile","title":"Example: creating a custom pricing strategy for Octopus Agile","text":"<p>Here I'm going to set up a custom pricing strategy which makes sure:</p> <ul> <li>I don't ever spend more than 10p/kWh</li> <li>I only ever switch on my device if carbon intensity is below 100 units</li> </ul> <p>Additionally I'm going to set up some custom actions which:</p> <ul> <li>Send a text message to my phone telling me that my smart plug is being switched on (done via AWS SNS)</li> <li>Send a HTTP RPC request to my shelly on the same WIFI network to start and stop when this conditions are met</li> </ul> <p>Note</p> <p>It's important to note that in this example, that the custom pricing strategy <code>CustomPricingStrategy</code> inherits from <code>PricingStrategy</code>, this is necessary otherwise you will hit a validation error to ensure it meets the contract and works with the rest of the code.</p> <pre><code>from energy_tariff_scheduler import runner, Price, PricingStrategy, ScheduleConfig\n\nclass CustomPricingStrategy(PricingStrategy):\n    def __init__(self, config: ScheduleConfig):\n        self.config = config # for access to other set configuration\n\n    def _get_carbon_intensity(self, price: Price):\n        res = requests.get(f\"https://api.carbonintensity.org.uk/intensity/{price.datetime_from}\")\n        return res.json()[\"data\"][0][\"intensity\"][\"actual\"]\n\n    def handle_price(self, price: Price, prices: list[Price]):\n        if price.value &lt; 10 and self._get_carbon_intensity(price) &lt; 100:\n            self.config.action_when_cheap(price)\n        else:\n            self.config.action_when_expensive(price)\n\ndef switch_shelly_on_and_alert(price: Price):\n    time = price.datetime_from.strftime(\"%H:%M\")\n    SMS.send(f\"Price is cheap ({price}p/kWh), turning on shelly\")\n    requests.get(\"http://&lt;shelly_ip&gt;/relay/0?turn=on\")\n\ndef switch_shelly_off_and_alert(price: Price):\n    time = price.datetime_from.strftime(\"%H:%M\")\n    SMS.send(f\"Price is expensive ({price}p/kWh), turning off shelly\")    \n    requests.get(\"http://&lt;shelly_ip&gt;/relay/0?turn=off\")\n\nrunner.run_octopus_agile_tariff_schedule(\n    prices_to_include=5, # 5 opportunties to trigger \"action_when_cheap\"\n    action_when_cheap=switch_shelly_on_and_alert,\n    action_when_expensive=switch_shelly_off_and_alert,\n    pricing_strategy=CustomPricingStrategy,\n    api_key=\"YOUR-API-KEY\",\n    account_number=\"YOUR-ACCOUNT-NUMBER\"\n)\n</code></pre>"},{"location":"quick-guides/quick-start-rpi/","title":"Raspberry Pi - Smart plug control","text":"<p>This guide should get you started with the library allowing you to see some actions happening in relation to price.</p>"},{"location":"quick-guides/quick-start-rpi/#requirements","title":"Requirements","text":"<ul> <li>Raspberry Pi that is WIFI enabled and supports CPython, a good option is a RPI 2W Pico which you can get for around \u00a325 online.</li> <li>Are on either Octopus Go, Intelligent Octopus Go or Agile Octopus tariff</li> </ul>"},{"location":"quick-guides/quick-start-rpi/#initial-setup","title":"Initial setup","text":"<ul> <li>Connect raspberry pi to laptop</li> <li>Connect a micro-hdmi to an external screen from the raspberry pi</li> <li>Run setup, remembering your password</li> <li>Connect to same WIFI your laptop is on</li> </ul>"},{"location":"quick-guides/quick-start-rpi/#setting-up-your-application","title":"Setting up your application","text":"<ul> <li>Once it is finished, let the boot sequence run till you see a desktop</li> <li>Open \"Terminal\"</li> <li>Type <code>python -v</code>, press enter and check if you are &gt;= 3.10 as this is needed for the package</li> <li>Type <code>touch run.py &amp;&amp; touch .env</code></li> <li>Be sure never to publish .env online or share it with anyone!</li> <li>Type <code>pip install energy-tariff-scheduler python-dotenv requests</code>, press enter and let it run, it's okay to install globally on RPI's if you're only running the one thing</li> <li>If you aren't, look into python virtual environments</li> </ul>"},{"location":"quick-guides/quick-start-rpi/#configuring-your-application","title":"Configuring your application","text":"<ul> <li>Go back to the desktop once this is complete, and right click <code>.env</code> and open with text editor</li> </ul> <p>Info</p> <ul> <li>Please refer to your smart plug app/documentation on how to get the IP address</li> <li>Getting your account number and API key is documented here.</li> </ul> <pre><code>OCTO_ACC_NO=YOUR-ACC-NUMBER\nOCTO_API_KEY=API_KEY\nSMART_DEVICE_IP=DEVICE_IP\n</code></pre> <ul> <li>Now save the .env file</li> <li>Now go back to the desktop and open the <code>run.py</code> file with your preferred editor (thawny programmer editor is a good default)</li> <li>Copy in the below starter code for your relevant tariff</li> </ul> <p>Info</p> <p>Please refer to your smart plug documentation on how to get the HTTP actions for switching on and off (lines 20 &amp; 24)</p> <ul> <li>Tapo: https://pypi.org/project/tapo/</li> <li>Shelly: https://shelly-api-docs.shelly.cloud/gen2/ComponentsAndServices/Switch/</li> </ul>"},{"location":"quick-guides/quick-start-rpi/#octopus-gointelligent-boilerplate","title":"Octopus Go/Intelligent Boilerplate","text":"<pre><code>import logging\nimport requests\n\nfrom energy_tariff_scheduler import Price, runner\nfrom dotenv import load_dotenv\nimport os\n\nload_dotenv()\n\nOCTO_ACC_NO = os.getenv('OCTO_ACC_NO')\nOCTO_API_KEY = os.getenv('OCTO_API_KEY')\nSMART_PLUG_IP = os.getenv('SMART_PLUG_IP')\n\nlogging.getLogger().setLevel(logging.DEBUG)\n\nlogging.debug(\"starting\")\n\ndef switch_device_on_and_alert(price: Price):\n    logging.info(f\"Price is cheap: {price}\")\n    # CODE FOR YOUR SMART PLUG TO SWITCH ON\n\ndef switch_device_off_and_alert(price: Price):\n    logging.info(f\"Price is expensive: {price}\")\n    # CODE FOR YOUR SMART PLUG TO SWITCH OFF\n\nrunner.run_octopus_go_tariff_schedule(\n    action_when_cheap=switch_shelly_on_and_alert,\n    action_when_expensive=switch_shelly_off_and_alert,\n    api_key=OCTO_API_KEY,\n    account_number=OCTO_ACC_NO,\n    is_intelligent=True\n)\n</code></pre>"},{"location":"quick-guides/quick-start-rpi/#octopus-agile-boilerplate","title":"Octopus Agile Boilerplate","text":"<pre><code>import logging\nimport requests\n\nfrom energy_tariff_scheduler import Price, runner\nfrom dotenv import load_dotenv\nimport os\n\nload_dotenv()\n\nOCTO_ACC_NO = os.getenv('OCTO_ACC_NO')\nOCTO_API_KEY = os.getenv('OCTO_API_KEY')\nSMART_PLUG_IP = os.getenv('SMART_PLUG_IP')\n\nlogging.getLogger().setLevel(logging.DEBUG)\n\nlogging.debug(\"starting\")\n\ndef switch_device_on_and_alert(price: Price):\n    logging.info(f\"Price is cheap: {price}\")\n    # CODE FOR YOUR SMART PLUG TO SWITCH ON\n\ndef switch_device_off_and_alert(price: Price):\n    logging.info(f\"Price is expensive: {price}\")\n    # CODE FOR YOUR SMART PLUG TO SWITCH OFF\n\nrunner.run_octopus_agile_tariff_schedule(\n    prices_to_include=24,\n    action_when_cheap=switch_shelly_on_and_alert,\n    action_when_expensive=switch_shelly_off_and_alert,\n    api_key=OCTO_API_KEY,\n    account_number=OCTO_ACC_NO,\n)\n</code></pre>"},{"location":"tariffs/configuration-go/","title":"Configuration go","text":""},{"location":"tariffs/configuration-go/#configuration","title":"Configuration","text":"<ul> <li><code>action_when_cheap</code> is your function that is called when the half hourly period is among the cheapest</li> <li><code>action_when_expensive</code> is your function that is called when the half hourly period is more expensive than the cheapest</li> <li><code>pricing_strategy</code> is a custom class you can pass in to act on prices in a more complex way (this is covered in custom pricing strategies)</li> <li><code>api_key</code> a secret key that gives the script access to fetch your most recent tariff (do not push this to git or share with anyone)</li> <li><code>account_number</code> your account number for a supported supplier and tariff</li> </ul>"},{"location":"tariffs/octo-api-key/","title":"Octo api key","text":"How do I get my account number &amp; API key? <p> Go to octopus.energy and sign in, then follow these steps after clicking the menu button on the home page. </p> <p>A best practice is to place these in a <code>.env</code> file, and bring them in with <code>python-dotenv</code>, be sure to put <code>.env</code> in a <code>.gitignore</code> file.</p>"},{"location":"tariffs/octopus-agile/","title":"Octopus Agile","text":"<p>Octopus Agile is an Octopus tariff which allows you to plan your usage for your current day, the pricings are following wholesale prices so you can take advantage of the fluctuations during the day and night while prices drop.</p>"},{"location":"tariffs/octopus-agile/#configuration","title":"Configuration","text":"<ul> <li><code>prices_to_include</code> is the number of the cheapest half hourly periods that you want to include<ul> <li>this can be a function (as defined in custom prices to include)</li> <li>or simply just an integer value between <code>0</code> and <code>46</code> ( a full day 0:00-23:00)</li> </ul> </li> <li><code>action_when_cheap</code> is your function that is called when the half hourly period is among the cheapest</li> <li><code>action_when_expensive</code> is your function that is called when the half hourly period is more expensive than the cheapest</li> <li><code>pricing_strategy</code> is a custom class you can pass in to act on prices in a more complex way (this is covered in custom pricing strategies)</li> <li><code>api_key</code> a secret key that gives the script access to fetch your most recent tariff (do not push this to git or share with anyone)</li> <li><code>account_number</code> your account number for a supported supplier and tariff</li> </ul> How do I get my account number &amp; API key? <p> Go to octopus.energy and sign in, then follow these steps after clicking the menu button on the home page. </p> <p>A best practice is to place these in a <code>.env</code> file, and bring them in with <code>python-dotenv</code>, be sure to put <code>.env</code> in a <code>.gitignore</code> file.</p>"},{"location":"tariffs/octopus-agile/#how-often-are-my-actions-called","title":"How often are my actions called","text":"<p>The actions happen every 30 minutes, if the price is cheap then <code>action_when_cheap</code> is called, if it is expensive then <code>action_when_expensive</code> is called.</p> <p>There is a 10 minute grace period on an action missing your current time from when you begin the schedule initially.</p>"},{"location":"tariffs/octopus-agile/#usage","title":"Usage","text":"<pre><code># main.py\nfrom energy_tariff_scheduler import runner, Price\n\ndef action_when_cheap(price: Price):\n    print(\"cheap\", price.value)\n\ndef action_when_expensive(price: Price)\n    print(\"expensive\", price.value)\n\nrunner.run_octopus_agile_tariff_schedule(\n  prices_to_include=12,\n  action_when_cheap=action_when_cheap,\n  action_when_expensive=action_when_expensive,\n  api_key=\"YOUR-API-KEY\",\n  account_number=\"YOUR-ACCOUNT-NUMBER\"\n)\n</code></pre>"},{"location":"tariffs/octopus-go/","title":"Octopus Go","text":"<p>Octopus Go is a tariff for EV owners who don't have an EV or charger that can be controlled in a smart way.</p>"},{"location":"tariffs/octopus-go/#configuration","title":"Configuration","text":"<ul> <li><code>action_when_cheap</code> is your function that is called when the half hourly period is among the cheapest</li> <li><code>action_when_expensive</code> is your function that is called when the half hourly period is more expensive than the cheapest</li> <li><code>pricing_strategy</code> is a custom class you can pass in to act on prices in a more complex way (this is covered in custom pricing strategies)</li> <li><code>api_key</code> a secret key that gives the script access to fetch your most recent tariff (do not push this to git or share with anyone)</li> <li><code>account_number</code> your account number for a supported supplier and tariff</li> </ul> How do I get my account number &amp; API key? <p> Go to octopus.energy and sign in, then follow these steps after clicking the menu button on the home page. </p> <p>A best practice is to place these in a <code>.env</code> file, and bring them in with <code>python-dotenv</code>, be sure to put <code>.env</code> in a <code>.gitignore</code> file.</p>"},{"location":"tariffs/octopus-go/#how-often-are-my-actions-called","title":"How often are my actions called","text":"<p>The actions happen 3 times during the entire day:</p> <ul> <li>00:00am when prices are expensive</li> <li>00:30am when prices are cheap</li> <li>05:30am when prices are expensive</li> </ul> <p>There is a 10 minute grace period on an action missing your current time from when you begin the schedule initially.</p>"},{"location":"tariffs/octopus-go/#usage","title":"Usage","text":"<pre><code># main.py\nfrom energy_tariff_scheduler import runner, Price\n\ndef action_when_cheap(price: Price):\n    print(\"cheap\", price.value)\n\ndef action_when_expensive(price: Price)\n    print(\"expensive\", price.value)\n\nrunner.run_octopus_go_tariff_schedule(\n  prices_to_include=12,\n  action_when_cheap=action_when_cheap,\n  action_when_expensive=action_when_expensive,\n  api_key=\"YOUR-API-KEY\",\n  account_number=\"YOUR-ACCOUNT-NUMBER\",\n  is_intelligent=False\n)\n</code></pre>"},{"location":"tariffs/octopus-intelligent-go/","title":"Octopus Intelligent Go","text":"<p>Octopus Intelligent Go is a tariff for EV owners who have an EV or charger that can be controlled in a smart way, this enabled Octopus via the Kraken platform to produce optimised and automated charging schedules, saving you money and letting you plug in and forget.</p>"},{"location":"tariffs/octopus-intelligent-go/#configuration","title":"Configuration","text":"<ul> <li><code>action_when_cheap</code> is your function that is called when the half hourly period is among the cheapest</li> <li><code>action_when_expensive</code> is your function that is called when the half hourly period is more expensive than the cheapest</li> <li><code>pricing_strategy</code> is a custom class you can pass in to act on prices in a more complex way (this is covered in custom pricing strategies)</li> <li><code>api_key</code> a secret key that gives the script access to fetch your most recent tariff (do not push this to git or share with anyone)</li> <li><code>account_number</code> your account number for a supported supplier and tariff</li> </ul> How do I get my account number &amp; API key? <p> Go to octopus.energy and sign in, then follow these steps after clicking the menu button on the home page. </p> <p>A best practice is to place these in a <code>.env</code> file, and bring them in with <code>python-dotenv</code>, be sure to put <code>.env</code> in a <code>.gitignore</code> file.</p>"},{"location":"tariffs/octopus-intelligent-go/#how-often-are-my-actions-called","title":"How often are my actions called","text":"<p>The actions happen 2 times during the entire day:</p> <ul> <li>05:30am when prices are expensive</li> <li>11:30pm when prices are cheap</li> </ul> <p>There is a 10 minute grace period on an action missing your current time from when you begin the schedule initially.</p>"},{"location":"tariffs/octopus-intelligent-go/#usage","title":"Usage","text":"<pre><code># main.py\nfrom energy_tariff_scheduler import runner, Price\n\ndef action_when_cheap(price: Price):\n    print(\"cheap\", price.value)\n\ndef action_when_expensive(price: Price)\n    print(\"expensive\", price.value)\n\nrunner.run_octopus_go_tariff_schedule(\n  prices_to_include=12,\n  action_when_cheap=action_when_cheap,\n  action_when_expensive=action_when_expensive,\n  api_key=\"YOUR-API-KEY\",\n  account_number=\"YOUR-ACCOUNT-NUMBER\",\n  is_intelligent=True\n)\n</code></pre>"}]}